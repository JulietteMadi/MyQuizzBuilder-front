import{G as b}from"./GuideItem-5b109424.js";import{u as v,c as n,r as c,m as p,a as G}from"./index-64d5ad15.js";import{_,m as y,r as $,o as l,c as d,a as s,h as q,v as x,n as j,t as h,d as w,F as f,e as L,b as u,i as A,u as C,f as k}from"./index-47eacef6.js";const V={setup(){return{v$:v({$autoDirty:!0})}},data(){return{topic:{name:"",guides:[]},allGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}],availableGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}]}},validations(){return{topic:{name:{required:n.withMessage("Veuillez renseigner un nom pour ce thème",c),maxLength:n.withMessage("Le nom du thème ne peut âs dépasser 100 caractères",p(100))},guides:{required:n.withMessage("Veuillez ajouter des fiches pratiques à ce thème",c),maxLength:n.withMessage("Ce thème ne peut pas contenir plus de 50 fiches pratiques",p(50)),minLength:n.withMessage("Ce thème doit contenir au moins 5 fiches pratiques",G(3))}}}},components:{GuideItem:b},computed:{...y(C,["token"]),invalidForm(){return this.topic.guides.length<5||!this.topic.name}},created(){this.addGuide()},methods:{addGuide(){this.updateAvailableGuides(),this.topic.guides.push({name:"",url:"",image:""})},deleteGuide(e){this.topic.guides.splice(e,1),this.updateAvailableGuides()},enableTooltip(e){const t=document.getElementById(e);bootstrap.Tooltip.getOrCreateInstance(t).enable()},updateAvailableGuides(){this.availableGuides=[];const e=this.topic.guides.map(i=>i.url);this.allGuides.filter(i=>!e.includes(i.url)).forEach(i=>{this.availableGuides.push(i)})},guidesFormat(){this.topic.guides.forEach(e=>{e.id&&delete e.url,e.id&&e.noUpdate&&(delete e.name,delete e.image),delete e.noUpdate})},async createTopic(){if(await this.v$.$validate()){this.guidesFormat();const t={Authorization:`Bearer ${this.token}`},i=await this.$http.post("/topics",this.topic,{headers:t});i.status==204||i.status==200?(this.$toast.success("toast-app",`Le guide ${this.topic.name} a bien été créé`),this.$router.push({name:"themes"})):(console.error(i),this.$toast.error("toast-app","Un problème est survenu à la création de ce thème"))}else this.$toast.error("toast-app","Les informations de votre thème ne sont pas valides")},async initGuides(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get("/guides",{headers:e});t.status===204||t.status===200?(this.allGuides=t.body,this.availableGuides=t.body):console.error(t)}}},z=s("h1",null,"Créer un thème",-1),F={class:"outlined my-4 p-4"},T={class:"row"},U={class:"col-12"},D=s("label",{for:"name",class:"fs-5"},"Nom du thème",-1),M={key:0,class:"text-danger"},B=s("div",{class:"cols-12 my-4"},[s("p",null,[u("Veuillez ajouter entre 5 et 50 fiches pratiques associées à ce thème."),s("br"),u(" Attention au choix de l’image et du nom de la fiche, ce sont les informations que les utilisateurs du quizz verront !")])],-1),S={key:0,class:"text-danger"},E=s("i",{class:"bi bi-plus-circle"},null,-1),I={class:"align-items-end flex-column px-2 row"},N=["disabled"],O=s("i",{class:"bi bi-plus-circle"},null,-1);function H(e,t,i,o,J,a){const g=$("GuideItem");return l(),d(f,null,[z,s("form",{class:"my-5",onSubmit:t[2]||(t[2]=A((...r)=>a.createTopic&&a.createTopic(...r),["prevent"]))},[s("div",F,[s("div",T,[s("div",U,[D,q(s("input",{name:"name",id:"name",type:"text",class:j(["form-control",{"is-invalid":o.v$.topic.name.$error}]),placeholder:"Ex : recrutement","onUpdate:modelValue":t[0]||(t[0]=r=>e.topic.name=r)},null,2),[[x,e.topic.name]]),o.v$.topic.name.$error?(l(),d("p",M,h(o.v$.topic.name.$errors[0].$message),1)):w("",!0)]),B]),o.v$.topic.guides.$error?(l(),d("p",S,h(o.v$.topic.guides.$errors[0].$message),1)):w("",!0),(l(!0),d(f,null,L(e.topic.guides,(r,m)=>(l(),d("div",{class:"row py-3 my-5 d-flex",key:m},[k(g,{index:m,guide:r,availableGuides:e.availableGuides,allGuides:e.allGuides,onDeleteGuide:a.deleteGuide,onUpdateGuidesList:a.updateAvailableGuides},null,8,["index","guide","availableGuides","allGuides","onDeleteGuide","onUpdateGuidesList"])]))),128)),s("button",{class:"btn secundary-button mt-2",onClick:t[1]||(t[1]=(...r)=>a.addGuide&&a.addGuide(...r)),type:"button"},[E,u(" Ajouter une fiche ")])]),s("div",I,[s("button",{class:"btn primary-button mt-2 col-12 col-md-3",type:"submit",disabled:a.invalidForm},[O,u(" Créer un thème ")],8,N)])],32)],64)}const R=_(V,[["render",H]]);export{R as default};
