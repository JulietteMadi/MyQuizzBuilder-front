import{_ as f,k as b,m as v,l as g,r as G,o as n,c as u,a as i,t as y,h as $,v as _,n as j,F as d,e as A,b as o,i as U,u as m,f as q}from"./index-e330a1bf.js";import{G as L}from"./GuideItem-093dfaa3.js";import{u as k,r as c,a as p,m as x}from"./index-59040036.js";const D={setup(){return{route:b(),v$:k({$autoDirty:!0})}},data(){return{id:this.route.params.id,topic:{name:this.route.params.name,guides:[{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"}]},allGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}],availableGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}]}},validations(){return{topic:{name:{required:c,maxLength:p(100)},guides:{required:c,maxLength:p(50),minLength:x(5)}}}},components:{GuideItem:L},computed:{...v(m,["token"]),invalidForm(){return this.topic.guides<4||!this.guide.name}},created(){},methods:{...g(m,["resetUser"]),addGuide(){this.updateAvailableGuides(),this.topic.guides.push({name:"",url:"",image:""})},deleteGuide(e){this.topic.guides.splice(e,1),this.updateAvailableGuides()},updateAvailableGuides(){this.availableGuides=[];const e=this.topic.guides.map(a=>a.url);this.allGuides.filter(a=>!e.includes(a.url)).forEach(a=>{this.availableGuides.push(a)})},guidesFormat(){this.topic.guides.forEach(e=>{if(!e.id){const t=this.allGuides.filter(a=>e.url===a.url);e.id=t[0].id}e.noUpdate&&(delete e.name,delete e.url,delete e.image),delete e.noUpdate})},async initTopic(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get(`/topics/${this.id}`,{headers:e});t.status===204||t.status===200?(this.topic=t.body,this.topic.guides.forEach(a=>{a.noUpdate=!0}),this.updateAvailableGuides()):(console.error(t),this.$router.push({name:"topics"}),this.$toast.error("toast-app","Une erreur est survenue"))},async initGuides(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get("/guides",{headers:e});t.status===204||t.status===200?(this.allGuides=t.body,await this.initTopic()):(console.error(t),this.$router.push({name:"topics"}),this.$toast.error("toast-app","Une erreur est survenue"))},async updateTopic(){await this.v$.$validate()?(this.$toast.success("toast-app",`Le guide ${this.topic.name} a bien été modifié`),this.$router.push({name:"themes"})):this.$toast.error("toast-app","Les informations de votre thème ne sont pas valides")}}},T={class:"outlined my-4 p-4"},S={class:"row"},z={class:"col-12"},F=i("label",{for:"name",class:"fs-5"},"Nom du thème",-1),V=i("div",{class:"cols-12 my-4"},[i("p",null,[o("Veuillez ajouter entre 5 et 50 fiches pratiques associées à ce thème."),i("br"),o(" Attention au choix de l’image et du nom de la fiche, ce sont les informations que les utilisateurs du quizz verront !")])],-1),B=i("i",{class:"bi bi-plus-circle"},null,-1),E=i("div",{class:"align-items-end flex-column row"},[i("button",{class:"btn primary-button mt-2 col-12 col-md-3",type:"submit"},[i("i",{class:"bi bi-pencil-square"}),o(" Modifier le thème ")])],-1);function M(e,t,a,h,N,r){const w=G("GuideItem");return n(),u(d,null,[i("h1",null,'Modifier le thème "'+y(e.topic.name)+'"',1),i("form",{class:"my-5",onSubmit:t[2]||(t[2]=U((...s)=>r.updateTopic&&r.updateTopic(...s),["prevent"]))},[i("div",T,[i("div",S,[i("div",z,[F,$(i("input",{name:"name",id:"name",type:"text",class:j(["form-control",{"is-invalid":h.v$.topic.name.$error}]),placeholder:"Ex : recrutement","onUpdate:modelValue":t[0]||(t[0]=s=>e.topic.name=s)},null,2),[[_,e.topic.name]])]),V]),(n(!0),u(d,null,A(e.topic.guides,(s,l)=>(n(),u("div",{class:"row py-3 my-5 d-flex",key:l},[q(w,{index:l,guide:s,availableGuides:e.availableGuides,allGuides:e.allGuides,onDeleteGuide:r.deleteGuide,onUpdateGuidesList:r.updateAvailableGuides},null,8,["index","guide","availableGuides","allGuides","onDeleteGuide","onUpdateGuidesList"])]))),128)),i("button",{class:"btn secundary-button mt-2",onClick:t[1]||(t[1]=(...s)=>r.addGuide&&r.addGuide(...s)),type:"button"},[B,o(" Ajouter une fiche ")])]),E],32)],64)}const R=f(D,[["render",M]]);export{R as default};
