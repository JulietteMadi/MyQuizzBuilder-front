import{_ as b,k as G,m as $,l as y,r as _,o as n,c as u,a as s,t as m,h as q,v as j,n as A,d as p,F as h,e as U,b as l,i as x,u as w,f as L}from"./index-47eacef6.js";import{G as k}from"./GuideItem-5b109424.js";import{u as M,c as d,r as f,m as g,a as V}from"./index-64d5ad15.js";const z={setup(){return{route:G(),v$:M({$autoDirty:!0})}},data(){return{id:this.route.params.id,topic:{name:this.route.params.name,guides:[{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"}]},allGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}],availableGuides:[{name:"Former les cadres supérieurs",url:"www.majrh.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.majrh.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.majrh.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.majrh.fr/onboarding-5-etapes",image:"www.temp.fr"}]}},validations(){return{topic:{name:{required:d.withMessage("Veuillez renseigner un nom pour ce thème",f),maxLength:d.withMessage("Le nom du thème ne peut âs dépasser 100 caractères",g(100))},guides:{required:d.withMessage("Veuillez ajouter des fiches pratiques à ce thème",f),maxLength:d.withMessage("Ce thème ne peut pas contenir plus de 50 fiches pratiques",g(50)),minLength:d.withMessage("Ce thème doit contenir au moins 5 fiches pratiques",V(5))}}}},components:{GuideItem:k},computed:{...$(w,["token"]),invalidForm(){return this.topic.guides<4||!this.guide.name}},created(){},methods:{...y(w,["resetUser"]),addGuide(){this.updateAvailableGuides(),this.topic.guides.push({name:"",url:"",image:""})},deleteGuide(e){this.topic.guides.splice(e,1),this.updateAvailableGuides()},updateAvailableGuides(){this.availableGuides=[];const e=this.topic.guides.map(i=>i.url);this.allGuides.filter(i=>!e.includes(i.url)).forEach(i=>{this.availableGuides.push(i)})},guidesFormat(){this.topic.guides.forEach(e=>{e.id&&delete e.url,e.id&&e.noUpdate&&(delete e.name,delete e.image),delete e.noUpdate})},async initTopic(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get(`/topics/${this.id}`,{headers:e});t.status===204||t.status===200?(this.topic=t.body,this.topic.guides.forEach(i=>{i.noUpdate=!0}),this.updateAvailableGuides()):(console.error(t),this.$router.push({name:"topics"}),this.$toast.error("toast-app","Une erreur est survenue"))},async initGuides(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get("/guides",{headers:e});t.status===204||t.status===200?(this.allGuides=t.body,await this.initTopic()):(console.error(t),this.$router.push({name:"topics"}),this.$toast.error("toast-app","Une erreur est survenue"))},async updateTopic(){const e=await this.v$.$validate();console.log(e),e?(this.$toast.success("toast-app",`Le guide ${this.topic.name} a bien été modifié`),this.$router.push({name:"themes"})):this.$toast.error("toast-app","Les informations de votre thème ne sont pas valides")}}},D={class:"outlined my-4 p-4"},T={class:"row"},S={class:"col-12"},C=s("label",{for:"name",class:"fs-5"},"Nom du thème",-1),F={key:0,class:"text-danger"},B=s("div",{class:"cols-12 my-4"},[s("p",null,[l("Veuillez ajouter entre 5 et 50 fiches pratiques associées à ce thème."),s("br"),l(" Attention au choix de l’image et du nom de la fiche, ce sont les informations que les utilisateurs du quizz verront !")])],-1),E={key:0,class:"text-danger"},N=s("i",{class:"bi bi-plus-circle"},null,-1),I=s("div",{class:"align-items-end flex-column ropx-2"},[s("button",{class:"btn primary-button mt-2 col-12 col-md-3",type:"submit"},[s("i",{class:"bi bi-pencil-square"}),l(" Modifier le thème ")])],-1);function O(e,t,i,o,R,r){const v=_("GuideItem");return n(),u(h,null,[s("h1",null,'Modifier le thème "'+m(e.topic.name)+'"',1),s("form",{class:"my-5",onSubmit:t[2]||(t[2]=x((...a)=>r.updateTopic&&r.updateTopic(...a),["prevent"]))},[s("div",D,[s("div",T,[s("div",S,[C,q(s("input",{name:"name",id:"name",type:"text",class:A(["form-control",{"is-invalid":o.v$.topic.name.$error}]),placeholder:"Ex : recrutement","onUpdate:modelValue":t[0]||(t[0]=a=>e.topic.name=a)},null,2),[[j,e.topic.name]]),o.v$.topic.name.$error?(n(),u("p",F,m(o.v$.topic.name.$errors[0].$message),1)):p("",!0)]),B]),o.v$.topic.guides.$error?(n(),u("p",E,m(o.v$.topic.guides.$errors[0].message),1)):p("",!0),(n(!0),u(h,null,U(e.topic.guides,(a,c)=>(n(),u("div",{class:"row py-3 my-5 d-flex",key:c},[L(v,{index:c,guide:a,availableGuides:e.availableGuides,allGuides:e.allGuides,onDeleteGuide:r.deleteGuide,onUpdateGuidesList:r.updateAvailableGuides},null,8,["index","guide","availableGuides","allGuides","onDeleteGuide","onUpdateGuidesList"])]))),128)),s("button",{class:"btn secundary-button mt-2",onClick:t[1]||(t[1]=(...a)=>r.addGuide&&r.addGuide(...a)),type:"button"},[N,l(" Ajouter une fiche ")])]),I],32)],64)}const P=b(z,[["render",O]]);export{P as default};
