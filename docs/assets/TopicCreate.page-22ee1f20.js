import{G as w}from"./GuideItem-fdc560c4.js";import{u as b,r as d,a as m,m as f}from"./index-d7f37177.js";import{_ as v,m as G,r as g,o as n,c as l,a as s,h as _,v as y,n as q,F as c,e as $,b as o,i as A,u as L,f as x}from"./index-c48083d6.js";const F={setup(){return{v$:b({$autoDirty:!0})}},data(){return{topic:{name:"",guides:[]},allGuides:[{name:"Former les cadres supérieurs",url:"www.mqb.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.mqb.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.mqb.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.mqb.fr/onboarding-5-etapes",image:"www.temp.fr"}],availableGuides:[{name:"Former les cadres supérieurs",url:"www.mqb.fr/former-cadres-superieurs",image:"www.temp.fr"},{name:"Savoir quand former un collaborateur",url:"www.mqb.fr/savoir-quand-former",image:"www.temp.fr"},{name:"Discriminations : les biais en recrutement",url:"www.mqb.fr/discrimination-biais-recrutement",image:"www.temp.fr"},{name:"Onboarding en 5 étapes",url:"www.mqb.fr/onboarding-5-etapes",image:"www.temp.fr"}]}},validations(){return{topic:{name:{required:d,maxLength:m(100)},guides:{required:d,maxLength:m(50),minLength:f(5)}}}},components:{GuideItem:w},computed:{...G(L,["token"]),invalidForm(){return this.topic.guides<4||!this.topic.name}},created(){this.addGuide()},methods:{addGuide(){this.updateAvailableGuides(),this.topic.guides.push({name:"",url:"",image:""})},deleteGuide(e){this.topic.guides.splice(e,1),this.updateAvailableGuides()},enableTooltip(e){const t=document.getElementById(e);bootstrap.Tooltip.getOrCreateInstance(t).enable()},updateAvailableGuides(){this.availableGuides=[];const e=this.topic.guides.map(i=>i.url);this.allGuides.filter(i=>!e.includes(i.url)).forEach(i=>{this.availableGuides.push(i)})},guidesFormat(){this.topic.guides.forEach(e=>{if(!e.id){const t=this.allGuides.filter(i=>e.url===i.url);e.id=t[0].id}e.noUpdate&&(delete e.name,delete e.url,delete e.image),delete e.noUpdate})},async createTopic(){if(await this.v$.$validate()){this.guidesFormat();const t={Authorization:`Bearer ${this.token}`},i=await this.$http.post("/topics",this.topic,{headers:t});i.status==204||i.status==200?(this.$toast.success("toast-app",`Le guide ${this.topic.name} a bien été créé`),this.$router.push({name:"themes"})):(console.error(i),this.$toast.error("toast-app","Un problème est survenu à la création de ce thème"))}else this.$toast.error("toast-app","Les informations de votre thème ne sont pas valides")},async initGuides(){const e={Authorization:`Bearer ${this.token}`},t=await this.$http.get("/guides",{headers:e});t.status===204||t.status===200?(this.allGuides=t.body,this.availableGuides=t.body):console.error(t)}}},T=s("h1",null,"Créer un thème",-1),U={class:"outlined my-4 p-4"},k={class:"row"},C={class:"col-12"},z=s("label",{for:"name",class:"fs-5"},"Nom du thème",-1),B=s("div",{class:"cols-12 my-4"},[s("p",null,[o("Veuillez ajouter entre 5 et 50 fiches pratiques associées à ce thème."),s("br"),o(" Attention au choix de l’image et du nom de la fiche, ce sont les informations que les utilisateurs du quizz verront !")])],-1),D=s("i",{class:"bi bi-plus-circle"},null,-1),V={class:"align-items-end flex-column row"},E=["disabled"],I=s("i",{class:"bi bi-plus-circle"},null,-1);function S(e,t,i,p,N,a){const h=g("GuideItem");return n(),l(c,null,[T,s("form",{class:"my-5",onSubmit:t[2]||(t[2]=A((...r)=>a.createTopic&&a.createTopic(...r),["prevent"]))},[s("div",U,[s("div",k,[s("div",C,[z,_(s("input",{name:"name",id:"name",type:"text",class:q(["form-control",{"is-invalid":p.v$.topic.name.$error}]),placeholder:"Ex : recrutement","onUpdate:modelValue":t[0]||(t[0]=r=>e.topic.name=r)},null,2),[[y,e.topic.name]])]),B]),(n(!0),l(c,null,$(e.topic.guides,(r,u)=>(n(),l("div",{class:"row py-3 my-5 d-flex",key:u},[x(h,{index:u,guide:r,availableGuides:e.availableGuides,allGuides:e.allGuides,onDeleteGuide:a.deleteGuide,onUpdateGuidesList:a.updateAvailableGuides},null,8,["index","guide","availableGuides","allGuides","onDeleteGuide","onUpdateGuidesList"])]))),128)),s("button",{class:"btn secundary-button mt-2",onClick:t[1]||(t[1]=(...r)=>a.addGuide&&a.addGuide(...r)),type:"button"},[D,o(" Ajouter une fiche ")])]),s("div",V,[s("button",{class:"btn primary-button mt-2 col-12 col-md-3",type:"submit",disabled:a.invalidForm},[I,o(" Créer un thème ")],8,E)])],32)],64)}const H=v(F,[["render",S]]);export{H as default};
